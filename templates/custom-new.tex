% Clean Custom LaTeX template for PublishJockey
% Supports both regular font setup and script-based font switching
\documentclass[$if(fontsize)$$fontsize$,$endif$$if(papersize)$$papersize$paper,$endif$$for(classoption)$$classoption$$sep$,$endfor$]{$documentclass$}

% Basic packages
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e}
\usepackage{fancyhdr}

% Font setup
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[$if(fontenc)$$fontenc$$else$T1$endif$]{fontenc}
  \usepackage[utf8]{inputenc}
$if(euro)$
  \usepackage{eurosym}
$endif$
\else % if luatex or xelatex
  \usepackage{fontspec}
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
$if(euro)$
  \newcommand{\euro}{â‚¬}
$endif$
\fi

% Chapter and section command definitions
\makeatletter
\providecommand{\thechapter}{}
\providecommand{\@chapapp}{}
\providecommand{\chaptertitlename}{Chapter}
\setcounter{secnumdepth}{-10}
\renewcommand{\thechapter}{}
\renewcommand{\thesection}{}
\renewcommand{\thesubsection}{}
\renewcommand{\thesubsubsection}{}
\def\@chapapp{}
\makeatother

% SCRIPT-BASED FONT SWITCHING SETUP
$if(script-switching)$
% Use ucharclasses for automatic script-based font switching
\usepackage{ucharclasses}

% Set the script font as main font (default for all text)
\setmainfont{$script-font$}[
  Script=$script-name$,
  Renderer=HarfBuzz,
  Ligatures=TeX,
  Scale=MatchLowercase$if(script-language)$,
  Language=$script-language$$endif$
]

% Define Latin font for automatic switching
\newfontfamily\englishfont{$if(sansfont)$$sansfont$$else$Liberation Serif$endif$}[
  Ligatures=TeX,
  Scale=MatchLowercase
]

% Automatic font switching: Switch to English font for Latin characters
\setTransitionsForLatin{
  \begingroup\englishfont
}{
  \endgroup
}

$else$
% STANDARD FONT SETUP (for Latin, Cyrillic, Arabic, etc.)

% RTL language support
$if(dir)$
\ifxetex
  $if(mainfont)$
  \setmainfont{$mainfont$}
  $endif$
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
  \newfontfamily\arabicfont[Script=Arabic]{Noto Sans Arabic}
  \newfontfamily\hebrewfont[Script=Hebrew]{Noto Sans Hebrew}
\fi
$endif$

% Standard font setup
$if(mainfont)$
    $if(mainfontoptions)$
    \setmainfont[$for(mainfontoptions)$$mainfontoptions$$sep$,$endfor$]{$mainfont$}
    $else$
    \setmainfont{$mainfont$}
    $endif$
$endif$

$if(sansfont)$
    $if(sansfontoptions)$
    \setsansfont[$for(sansfontoptions)$$sansfontoptions$$sep$,$endfor$]{$sansfont$}
    $else$
    \setsansfont{$sansfont$}
    $endif$
$endif$

$if(monofont)$
    $if(monofontoptions)$
    \setmonofont[Mapping=tex-ansi,$for(monofontoptions)$$monofontoptions$$sep$,$endfor$]{$monofont$}
    $else$
    \setmonofont[Mapping=tex-ansi]{$monofont$}
    $endif$
$endif$

% RTL setup
$if(dir)$
\ifxetex
  $if(latex-dir-rtl)$
  \usepackage[RTLdocument]{bidi}
  $else$
  \usepackage{bidi}
  $endif$
\fi
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \TeXXeTstate=1
\fi
$endif$

$endif$

% Additional packages
\usepackage{geometry}
$if(script-switching)$
% For script-switching languages, skip titlesec to avoid conflicts
$else$
\usepackage{titlesec}
$endif$
\usepackage{setspace}
\usepackage{enumitem}
\usepackage{microtype}
\usepackage{xcolor}
\usepackage{calc}
\usepackage{array}
\usepackage{ragged2e}

% Table support
\usepackage{longtable,booktabs}
\usepackage{graphicx}

% Page setup
$if(geometry)$
\geometry{$geometry$}
$endif$

% Header/footer setup
$if(pagestyle)$
\pagestyle{$pagestyle$}
$endif$

% Title formatting (only for non-script-switching languages)
$if(secstyle)$
$if(script-switching)$
% Skip title formatting for script-switching languages (no titlesec package)
$else$
\titleformat{\chapter}{\huge\bfseries\filcenter}{}{0em}{}
$endif$
$endif$

% Spacing and formatting
$if(setspace)$
\setstretch{$setspace$}
$endif$

% List formatting
\setlist{nolistsep}

% Widow/orphan control
\widowpenalty=10000
\clubpenalty=10000

% Emergency stretch for better justification
\emergencystretch=3em

% Pandoc tightlist environment
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Section numbering control
$if(secnumdepth)$
\setcounter{secnumdepth}{$secnumdepth$}
$endif$

% TOC depth control
$if(tocdepth)$
\setcounter{tocdepth}{$tocdepth$}
$endif$

% Unicode-aware PDF setup
\ifxetex
  \usepackage[unicode]{hyperref}
  \hypersetup{
    pdfencoding=auto,
    bookmarksopen=true,
    bookmarksopenlevel=1
  }
\fi

% Document begin
\begin{document}

% Title page
$if(title)$
\title{$title$}
$endif$
$if(author)$
\author{$author$}
$endif$
$if(date)$
\date{$date$}
$endif$

$if(title)$
\maketitle
$endif$

% Table of Contents
$if(toc)$
\tableofcontents
$endif$

% Main content
$body$

% Bibliography
$if(bibliography)$
\bibliography{$bibliography$}
$endif$

\end{document}
