% Custom LaTeX template for Publisher-Grade Tamil Typography
% Production-ready version for XeLaTeX + Pandoc
% Simplified Polyglossia setup to avoid common errors
% Yancy Dennis

\documentclass[$if(fontsize)$$fontsize$,$endif$$for(classoption)$$classoption$$sep$,$endfor$]{$documentclass$}

% Essential packages
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e}

% XeLaTeX-specific setup for Tamil
\ifxetex
  \usepackage{fontspec}
  
  % SIMPLIFIED POLYGLOSSIA: Conservative configuration
  \usepackage{polyglossia}
  \setdefaultlanguage{tamil}
  \setotherlanguage{english}
  
  % FONTS: Optimized Tamil fonts with essential OpenType features
  \setmainfont{$if(mainfont)$$mainfont$$else$Noto Serif Tamil$endif$}[
    Renderer=HarfBuzz,
    Script=Tamil,
    Language=Tamil,
    Ligatures={Required,Common},
    % Essential OpenType features for Tamil
    RawFeature={+kern,+liga,+clig,+calt,+ccmp,+locl,+mark,+mkmk,+akhn},
    Scale=1.0,
    WordSpace=1.0,
    PunctuationSpace=1.0
  ]
  
  % English/Latin font for mixed content
  \newfontfamily\englishfont{$if(romanfont)$$romanfont$$else$Libertinus Serif$endif$}[
    Renderer=HarfBuzz,
    Ligatures={Required,Common},
    RawFeature={+kern,+liga,+clig},
    Scale=MatchLowercase
  ]
  
  % Monospace font
  \setmonofont{$if(monofont)$$monofont$$else$Inconsolata$endif$}[
    Scale=MatchLowercase
  ]
  
  % Conservative microtype settings
  \usepackage{microtype}
  \microtypesetup{
    activate=true,
    protrusion=true,
    expansion=false,
    spacing=false,
    tracking=false,
    kerning=true
  }

\else
  % Fallback for non-XeLaTeX engines
  \usepackage[utf8]{inputenc}
  \usepackage[T1]{fontenc}
  \usepackage{lmodern}
\fi

% PUBLISHER-GRADE TYPOGRAPHY for Tamil
\linespread{1.10}  % Optimized for Tamil readability

% Paragraph formatting
\setlength{\parindent}{1.5em}
\setlength{\parskip}{0.2em plus 0.1em minus 0.05em}

% Professional justification settings
\tolerance=1000
\pretolerance=200
\emergencystretch=1.0em

% Disable hyphenation for Tamil (linguistically inappropriate)
\hyphenpenalty=10000
\exhyphenpenalty=10000

% Widow and orphan control
\widowpenalty=10000
\clubpenalty=10000
\displaywidowpenalty=10000

% Better page breaking
\raggedbottom
\parfillskip=0pt plus 1fil

% Page setup
\makeatletter
\def\@oddfoot{\hfil\thepage\hfil}
\def\@evenfoot{\hfil\thepage\hfil}
\def\@oddhead{}
\def\@evenhead{}
\makeatother

\pagestyle{plain}

% Unicode-aware PDF setup
\usepackage[unicode,bookmarks=true]{hyperref}
\hypersetup{
  pdfencoding=auto,
  bookmarksopen=true,
  bookmarksopenlevel=2,
  unicode=true,
  pdftitle={$if(title-meta)$$title-meta$$else$$if(title)$$title$$endif$$endif$},
  pdfauthor={$if(author-meta)$$author-meta$$else$$if(author)$$author$$endif$$endif$},
  pdfsubject={$if(subject)$$subject$$else$$if(title)$$title$$endif$$endif$},
  pdfkeywords={$if(keywords)$$for(keywords)$$keywords$$sep$, $endfor$$endif$},
  colorlinks=false,
  hidelinks=true
}

% Page geometry
$if(paperwidth)$
\usepackage[
  paperwidth=$paperwidth$,
  paperheight=$paperheight$,
  left=$leftmargin$,
  right=$rightmargin$,
  top=$topmargin$,
  bottom=$bottommargin$,
  footskip=$footskip$,
  bindingoffset=0pt
]{geometry}
$endif$

% Page style customization
$if(pagestyle)$
\pagestyle{$pagestyle$}
$endif$

% Section formatting
$if(secstyle)$
\usepackage{titlesec}
\titleformat{\chapter}[display]
  {\normalfont\huge\bfseries\centering}
  {\chaptertitlename\ \thechapter}
  {1ex}
  {}
\titleformat{\section}
  {\normalfont\Large\bfseries}
  {\thesection}
  {1em}
  {}
\titleformat{\subsection}
  {\normalfont\large\bfseries}
  {\thesubsection}
  {1em}
  {}
$endif$

% Spacing customization
$if(setspace)$
\usepackage{setspace}
\setstretch{$setspace$}
$endif$

% Lists optimization
\usepackage{enumitem}
\setlist{
  itemsep=0.2em,
  parsep=0.1em,
  topsep=0.4em,
  leftmargin=1.8em
}

% Tight list for Pandoc
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}%
  \setlength{\parskip}{0pt}%
}

% Section numbering
$if(secnumdepth)$
\setcounter{secnumdepth}{$secnumdepth$}
$endif$

% TOC depth
$if(tocdepth)$
\setcounter{tocdepth}{$tocdepth$}
$endif$

% Tables and graphics
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{array}
\usepackage{graphicx}
\usepackage{calc}

% Better table formatting
\renewcommand{\arraystretch}{1.05}

% Front/Main/Back matter
\renewcommand{\frontmatter}{%
  \cleardoublepage
  \pagenumbering{roman}
  \setcounter{page}{1}
  \pagestyle{plain}
}

\renewcommand{\mainmatter}{%
  \cleardoublepage
  \pagenumbering{arabic}
  \setcounter{page}{1}
  \pagestyle{plain}
}

\renewcommand{\backmatter}{%
  \cleardoublepage
  \pagestyle{plain}
}

% DOCUMENT START
\begin{document}

% Table of Contents
$if(toc)$
{
\hypersetup{linkcolor=black}
\setcounter{tocdepth}{$toc-depth$}
\tableofcontents
}
$endif$

% Main content
$body$

% Bibliography
$if(bibliography)$
\bibliography{$bibliography$}
$endif$

\end{document}