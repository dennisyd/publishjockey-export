% Custom LaTeX template for PublishJockey
% This template handles all formatting for PDF exports

\documentclass[$if(fontsize)$$fontsize$,$endif$$if(papersize)$$papersize$paper,$endif$$for(classoption)$$classoption$$sep$,$endfor$]{$documentclass$}

% Note: Using book class for proper front/main matter handling

\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript



% --- Load fancyhdr for page styling ---
\usepackage{fancyhdr}

\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[$if(fontenc)$$fontenc$$else$T1$endif$]{fontenc}
  \usepackage[utf8]{inputenc}
$if(euro)$
  \usepackage{eurosym}
$endif$
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
$for(fontfamilies)$
  \newfontfamily{$fontfamilies.name$}[$fontfamilies.options$]{$fontfamilies.font$}
$endfor$
$if(euro)$
  \newcommand{\euro}{â‚¬}
$endif$

% --- Additional font setup for RTL languages and Hindi ---
$if(dir)$
\ifxetex
  % Ensure proper font loading for RTL languages
  $if(mainfont)$
  \setmainfont{$mainfont$}
  $endif$
  % Additional font features for RTL languages
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
  % Explicit font loading for RTL languages
  \newfontfamily\arabicfont[Script=Arabic]{Noto Sans Arabic}
  \newfontfamily\hebrewfont[Script=Hebrew]{Noto Sans Hebrew}
\fi
$endif$

% --- FONT SETUP ---
$if(polyglossia)$
% Hindi language setup with polyglossia
\ifxetex
  \usepackage{polyglossia}
  \setdefaultlanguage{hindi}
  \setotherlanguage{english}
  
  % Set up main Hindi font
  \setmainfont{Noto Sans Devanagari}[
    Script=Devanagari,
    Ligatures=TeX,
    Scale=MatchLowercase,
    Language=Hindi
  ]
  
  % CRITICAL: Set up proper font fallback for Latin characters
  % This prevents rectangles for English text
  \setsansfont{$if(sansfont)$$sansfont$$else$Liberation Serif$endif$}[
    Script=Latin,
    Ligatures=TeX,
    Scale=MatchLowercase$if(sansfontoptions)$,
    $sansfontoptions$$endif$
  ]
  
  % Note: fontspec doesn't have \setseriffont, we use \setmainfont for serif
  % The main font is already set to Noto Sans Devanagari above
  
  % Configure XeLaTeX to automatically fallback to sans/serif fonts for Latin text
  \newfontfamily\englishfont{$if(sansfont)$$sansfont$$else$Liberation Serif$endif$}[
    Script=Latin,
    Ligatures=TeX,
    Scale=MatchLowercase
  ]
  
  % Unicode-aware PDF setup
  \usepackage[unicode]{hyperref}
  \hypersetup{
    pdfencoding=auto,
    bookmarksopen=true,
    bookmarksopenlevel=1
  }
\fi
$else$
% Standard font setup for non-Hindi languages
$if(mainfont)$
    $if(mainfontoptions)$
    \setmainfont[$for(mainfontoptions)$$mainfontoptions$$sep$,$endfor$]{$mainfont$}
    $else$
    \setmainfont{$mainfont$}
    $endif$
$endif$
$if(sansfont)$
    $if(sansfontoptions)$
    \setsansfont[$for(sansfontoptions)$$sansfontoptions$$sep$,$endfor$]{$sansfont$}
    $else$
    \setsansfont{$sansfont$}
    $endif$
$endif$
$if(seriffont)$
    % Note: fontspec doesn't have \setseriffont, serif fonts are handled by \setmainfont
$endif$

% Load hyperref for all documents (not just Hindi)
\ifxetex
  \usepackage[unicode]{hyperref}
  \hypersetup{
    pdfencoding=auto,
    bookmarksopen=true,
    bookmarksopenlevel=1
  }
\fi
$endif$


$if(monofont)$
    $if(monofontoptions)$
    \setmonofont[Mapping=tex-ansi,$for(monofontoptions)$$monofontoptions$$sep$,$endfor$]{$monofont$}
    $else$
    \setmonofont[Mapping=tex-ansi]{$monofont$}
    $endif$
$endif$
$if(mathfont)$
    % Note: \setmathfont requires unicode-math package, which we're not using
    % Math fonts are handled automatically by the main font setup
$endif$

\fi

% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[$for(microtypeoptions)$$microtypeoptions$$sep$,$endfor$]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}

% Language-specific packages for RTL support
$if(dir)$
\ifxetex
  % load bidi as late as possible as it modifies e.g. graphicx
  $if(latex-dir-rtl)$
  \usepackage[RTLdocument]{bidi}
  $else$
  \usepackage{bidi}
  $endif$
  % Additional bidirectional text support for XeLaTeX
  \usepackage{fontspec}
  \usepackage{xunicode}
  \usepackage{xltxtra}
  % Additional packages for better RTL text rendering
  \usepackage{polyglossia}
  % Set up languages with specific fonts
  \setdefaultlanguage{english}
  $if(lang.arabic)$
  \setotherlanguage{arabic}
  \newfontfamily\arabicfont[Script=Arabic]{Noto Sans Arabic}
  $endif$
  $if(lang.hebrew)$
  \setotherlanguage{hebrew}
  \newfontfamily\hebrewfont[Script=Hebrew]{Noto Sans Hebrew}
  $endif$
\fi
$endif$

% Basic RTL support for pdfTeX (simplified)
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \TeXXeTstate=1
\fi

% CUSTOM PACKAGES FOR BETTER BOOK FORMATTING
\usepackage{sectsty}               % For section formatting
\usepackage{titlesec}              % Advanced title formatting
\usepackage{tocloft}               % TOC formatting
\usepackage{fancyhdr}              % Required for page numbering and styles
\usepackage{tocbibind}
\usepackage{etoolbox}              % Programming tools
\usepackage{bookmark}              % PDF bookmarks
\usepackage{longtable}             % Required for markdown tables
\usepackage{setspace}              % Required for \setstretch
\usepackage{booktabs}              % Required for \toprule, \midrule, \bottomrule in tables
\usepackage{graphicx}              % Required for \includegraphics
% Add packages for advanced table support
\RequirePackage{calc}
\RequirePackage{array}
\RequirePackage{ragged2e}

% --- Additional packages ---
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{setspace}
\usepackage{enumitem}
\usepackage{microtype}
\usepackage{xcolor}
\usepackage{calc}
\usepackage{array}
\usepackage{ragged2e}

% --- Chapter and section command definitions ---
% These need to be defined after the document class but before they're used
\makeatletter
% Define chapter and section commands to prevent undefined errors
\providecommand{\thechapter}{}
\providecommand{\@chapapp}{}
\providecommand{\chaptertitlename}{Chapter}

% Remove all section numbering to match the desired style
\setcounter{secnumdepth}{-10}
\renewcommand{\thechapter}{}
\renewcommand{\thesection}{}
\renewcommand{\thesubsection}{}
\renewcommand{\thesubsubsection}{}
\def\@chapapp{}
\makeatother

% --- Page setup ---
$if(geometry)$
\geometry{$geometry$}
$endif$

% --- Header/footer setup ---
$if(pagestyle)$
\pagestyle{$pagestyle$}
$endif$

% --- Title formatting ---
$if(secstyle)$
\titleformat{\chapter}{\huge\bfseries\filcenter}{}{0em}{}
$endif$

% --- Spacing and formatting ---
$if(setspace)$
\setstretch{$setspace$}
$endif$

% --- List formatting ---
\setlist{nolistsep}

% --- Widow/orphan control ---
\widowpenalty=10000
\clubpenalty=10000

% --- Emergency stretch for better justification ---
\emergencystretch=3em

% --- Pandoc tightlist environment ---
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% --- Section numbering control ---
$if(secnumdepth)$
\setcounter{secnumdepth}{$secnumdepth$}
$endif$

% --- TOC depth control ---
$if(tocdepth)$
\setcounter{tocdepth}{$tocdepth$}
$endif$

% --- Document begin ---
\begin{document}

% --- Title page ---
$if(title)$
\title{$title$}
$endif$
$if(author)$
\author{$author$}
$endif$
$if(date)$
\date{$date$}
$endif$

$if(title)$
\maketitle
$endif$

% --- Table of Contents ---
$if(toc)$
\tableofcontents
$endif$

% --- Main content ---
$body$

% --- Bibliography ---
$if(bibliography)$
\bibliography{$bibliography$}
$endif$

\end{document}